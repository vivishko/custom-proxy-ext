# 02. Warn on duplicate rule (manual)

## Context / why
Сейчас при ручном добавлении или редактировании правила можно незаметно создать дубликат для того же домена, что приводит к путанице и лишним записям в списке правил.

## Goals
- Предупреждать пользователя о дубликате доменного правила при ручном добавлении или редактировании.
- Снизить вероятность случайных дубликатов в списке правил.

## Non-goals
- Обработка дубликатов при импорте правил.
- Автоматические изменения без выбора пользователя.

## User scenarios
- Пользователь вводит домен, который уже есть в правилах, видит предупреждение и выбирает «Заменить правило».
- Пользователь редактирует существующее правило и меняет домен на уже занятый — получает предупреждение и выбирает отмену или замену.

## Requirements
- Must: При ручном добавлении правила показывать предупреждение, если домен уже существует в правилах.
- Must: При ручном редактировании правила показывать предупреждение, если новый домен уже существует в правилах (кроме текущего правила).
- Must: Предупреждение предлагает выбор: отменить или заменить существующее правило.
- Must: При выборе замены новое правило перезаписывает существующее для домена.
- Should: Текст предупреждения четко указывает, что найдено дублирующее правило для домена.
- Should: Предупреждение отображается до сохранения, чтобы избежать лишней записи.
- Could: Показывать ссылку/краткую подсказку на уже существующее правило (например, имя правила или домен).

## Risks / questions
- Какой точный текст предупреждения использовать.
- Должен ли список правил считать домен регистронезависимым (обычно да).
- Как обрабатывать домены с поддоменами (строгое совпадение или нормализация).

## Plan (steps)
- Определить логику проверки дубликатов при вводе домена.
- Добавить предупреждение в форму добавления правила.
- Добавить предупреждение в форму редактирования правила.
- Проверить сценарии подтверждения и отмены.

## Instruction for AI
Сформулируй текст предупреждения (RU/EN) и предложи UX-поведение выбора (кнопки «Отмена» / «Заменить правило», модальное окно или inline-алерт).
